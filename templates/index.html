{# Komentar #}
{% extends "layout/Dashboard/master.html" %}

{% set title = "Tugas AKhir - Twig" %}

{% block content %}

{% if hasvalidate == true %}
<script>

  // swal.fire({
  //                 title:"", 
  //                 text:"Loading...",
  //                 icon: "https://www.boasnotas.com/img/loading2.gif",
  //                 buttons: false,      
  //                 closeOnClickOutside: false,
  //                 timer: 3000,
  //                 //icon: "success"
  //             });

  let timerInterval
  Swal.fire({
    title: 'Memuat Data...',
    html: 'Tunggu  <b></b>  Detik.',
    timer: 2000,
    timerProgressBar: true,
    didOpen: () => {
      Swal.showLoading()
      const b = Swal.getHtmlContainer().querySelector('b')
      timerInterval = setInterval(() => {
        b.textContent = Swal.getTimerLeft()
      }, 100)
    },
    willClose: () => {
      clearInterval(timerInterval)
    }
  }).then((result) => {
    /* Read more about handling dismissals below */
    if (result.dismiss === Swal.DismissReason.timer) {
      console.log('I was closed by the timer')
    }
  })
</script>

{% endif %}

<section class="section py-5">
  <div class="container">
    <div class="row bg-light shadow-lg py-5">

      <div class="col-lg-10 col-12 text-center mx-auto">
        <h2 class="mb-5">Selamat Datang {{username}} di Slim Framework</h2>
      </div>

      <div class="col-lg-3 col-md-6 col-12 mb-4 mb-lg-0">
        <div class=" d-flex justify-content-center align-items-center">
          <a>
            <img src="img/icons/hands.png" class="-image img-fluid" alt="">

            <p class="text-center">Menjadi <strong> Progamer</strong></p>
          </a>
        </div>
      </div>

      <div class="col-lg-3 col-md-6 col-12 mb-4 mb-lg-0 mb-md-4">
        <div class=" d-flex justify-content-center align-items-center">
          <a>
            <img src="img/icons/heart.png" class="-image img-fluid" alt="">

            <p class="text-center"><strong>Penyelamat </strong>Bug</p>
          </a>
        </div>
      </div>

      <div class="col-lg-3 col-md-6 col-12 mb-4 mb-lg-0 mb-md-4">
        <div class=" d-flex justify-content-center align-items-center text-center">
          <a>
            <img src="img/icons/receive.png" class="-image img-fluid" alt="">

            <p class="text-center">Salurkan <strong>Kemampuan</strong></p>
          </a>
        </div>
      </div>

      <div class="col-lg-3 col-md-6 col-12 mb-4 mb-lg-0">
        <div class=" d-flex justify-content-center align-items-center">
          <a>
            <img src="img/icons/scholarship.png" class="-image img-fluid" alt="">

            <p class="text-center"><strong>Pendidikan </strong>Informatika</p>
          </a>
        </div>
      </div>

    </div>
  </div>

</section>

<section class="section py-5 " id="Data">
  <div class="container">
    <div class="row bg-light shadow-lg py-5">

      <div class="col-lg-12 col-12 text-center mb-4">
        <h2>Data Mahasiswa</h2>

        <div class="position-relative justify-content-right">

          <div class="position-absolute top-0 end-0 translate-middle p-2">
            <button button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#tambah">Tambah
              Data</button>

          </div>
        </div>


      </div>

      <table class="table" id="mydataa">
        <thead class="thead-dark">
          <tr>
            <th scope="col">#</th>
            <th scope="col">Nama</th>
            <th scope="col">Jenis Kelamin</th>
            <th scope="col">Kota</th>
            <th scope="col">Jurusan</th>
            <th scope="col">Aksi</th>
          </tr>
        </thead>
        <tbody>
          {% for user in data %}
          <tr>
            <th scope="row">{{ loop.index }}
            </th>
            <td>{{user.nama}}</td>
            <td>{{user.jenis_kelamin}}</td>
            <td>{{user.kota}}</td>
            <td>{{user.jurusan}}</td>
            <td>
              <!-- Link to open the modal -->
              <button button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#exampleModal"
                data-bs-whatever="{{user.id}}">Ubah</button>
              <button type="button" class="btn btn-danger delete_items" id="{{user.id}}">Hapus</button>
            </td>
          </tr>
          {%endfor%}
        </tbody>
      </table>




    </div>

  </div>
</section>

<section class="section py-5 " id="Data">
  <div class="container">
    <div class="row bg-light shadow-lg py-5">

      <div class="col-lg-12 col-12 text-center mb-4">
        <h2>Data Mahasiswa</h2>

        <div class="position-relative justify-content-right">


          <div class="pull-right justify-content-right"><a href="#" class="btn btn-sm btn-success" data-toggle="modal"
              data-target="#ModalaAdd"><span class="fa fa-plus"></span> Tambah Barang</a></div>
        </div>


      </div>

      <div class="row">
        <div id="reload">
          <table class="table table-striped" id="mydata">
            <thead>
              <tr>
                <th>Nama</th>
                <th>Jenis Kelamin</th>
                <th>Kota</th>
                <th>Jurusan</th>
                <th style="text-align: right;">Aksi</th>
              </tr>
            </thead>
            <tbody id="show_data">

            </tbody>
          </table>
        </div>
      </div>




    </div>

  </div>
</section>

<div class="modal fade" id="tambah" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Tambah Data</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="/tambah-data" method="POST">

          <div class="mb-3">
            <label for="recipient-name" class="col-form-label">Nama:</label>
            <input type="text" class="form-control " id="name" required>
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">Jenis Kelamin:</label>
            <select class="form-select" id="kelamin" aria-label="Default select example">
              <option selected>Pilih jenis kelamin</option>
              <option value="Laki-laki">Laki-laki</option>
              <option value="Perempuan">Perempuan</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">Kota:</label>
            <input type="text" class="form-control disable" id="kta" required>
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">Jurusan</label>
            <select class="form-select" id="jrs" aria-label="Default select example">
              <option selected>Pilih jurusan</option>
              {% for user in jurusan %}
              <option value="{{user.jurusan_id}}">{{user.jurusan}}</option>
              {% endfor %}

            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="button" class="btn btn-primary tambah_items">Tambah</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Ubah Data</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>

          <div class="mb-3">
            <label for="recipient-name" class="col-form-label">Nama:</label>
            <input type="text" class="form-control disable" id="nama">
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">Jenis Kelamin:</label>
            <select class="form-select" id="jenis_kelamin" aria-label="Default select example">
              <option value="Laki-laki">Laki-laki</option>
              <option value="Perempuan">Perempuan</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">Kota:</label>
            <input type="text" class="form-control disable" id="kota">
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">Jurusan</label>
            <select class="form-select" id="jurusan" aria-label="Default select example">
              {% for user in jurusan %}
              <option value="{{user.jurusan_id}}">{{user.jurusan}}</option>
              {% endfor %}

            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="button" class="btn btn-primary">Simpan</button>
      </div>
    </div>
  </div>
</div>





<script>
  $(document).ready(function () {
    $('#mydataa').DataTable();
  });
  const exampleModal = document.getElementById('exampleModal')
  exampleModal.addEventListener('show.bs.modal', event => {
    // Button that triggered the modal
    const button = event.relatedTarget
    // Extract info from data-bs-* attributes
    const id = button.getAttribute('data-bs-whatever')
    $(function () {
      $.ajax({
        type: "GET",
        url: "/" + id + "/select",
        success: function (response) {
          if (response) {
            //console.log(response)
            $("#nama").val(response[0].nama)
            $("#jenis_kelamin").val(response[0].jenis_kelamin)
            $("#kota").val(response[0].kota)
            $("#jurusan").val(response[0].id_jurusan)

          } else {
            //swal error
          }
        }
      })
    })
    const modalTitle = exampleModal.querySelector('.modal-title')
    const modalBodyInput = exampleModal.querySelector('.modal-body input')

    //modalTitle.textContent = `New message to ${recipient}`
    //modalBodyInput.value = recipient
  })
</script>

<script type="text/javascript">
  $(document).ready(function () {
    tampil_data_barang();   //pemanggilan fungsi tampil barang.

    $('#mydata').dataTable();

    //fungsi tampil barang
    function tampil_data_barang() {
      $.ajax({
        type: 'GET',
        url: '/tampil-data',
        async: true,
        dataType: 'json',
        success: function (data) {
          console.log(data)

          var html = '';
          var i;
          for (i = 0; i < data.length; i++) {
            html += '<tr>' +
              '<td>' + data[i].nama + '</td>' +
              '<td>' + data[i].jenis_kelamin + '</td>' +
              '<td>' + data[i].kota + '</td>' +
              '<td>' + data[i].jurusan + '</td>' +
              '<td style="text-align:right;">' +
              '<a href="javascript:;" class="btn btn-info btn-xs item_edit" data="' + data[i].id + '">Edit</a>' + ' ' +
              '<a href="javascript:;" class="btn btn-danger btn-xs item_hapus" data="' + data[i].id + '">Hapus</a>' +
              '</td>' +
              '</tr>';
          }
          $('#show_data').html(html);
        }

      });
    }

    //GET UPDATE
    $('#show_data').on('click', '.item_edit', function () {
      var id = $(this).attr('data');
      $.ajax({
        type: "GET",
        url: "<?php echo base_url('index.php/barang/get_barang')?>",
        dataType: "JSON",
        data: { id: id },
        success: function (data) {
          $.each(data, function (barang_kode, barang_nama, barang_harga) {
            $('#ModalaEdit').modal('show');
            $('[name="kobar_edit"]').val(data.barang_kode);
            $('[name="nabar_edit"]').val(data.barang_nama);
            $('[name="harga_edit"]').val(data.barang_harga);
          });
        }
      });
      return false;
    });


    //GET HAPUS
    $('#show_data').on('click', '.item_hapus', function () {
      var id = $(this).attr('data');
      $('#ModalHapus').modal('show');
      $('[name="kode"]').val(id);
    });

    //Simpan Barang
    $('#btn_simpan').on('click', function () {
      var kobar = $('#kode_barang').val();
      var nabar = $('#nama_barang').val();
      var harga = $('#harga').val();
      $.ajax({
        type: "POST",
        url: "<?php echo base_url('index.php/barang/simpan_barang')?>",
        dataType: "JSON",
        data: { kobar: kobar, nabar: nabar, harga: harga },
        success: function (data) {
          $('[name="kobar"]').val("");
          $('[name="nabar"]').val("");
          $('[name="harga"]').val("");
          $('#ModalaAdd').modal('hide');
          tampil_data_barang();
        }
      });
      return false;
    });

    //Update Barang
    $('#btn_update').on('click', function () {
      var kobar = $('#kode_barang2').val();
      var nabar = $('#nama_barang2').val();
      var harga = $('#harga2').val();
      $.ajax({
        type: "POST",
        url: "<?php echo base_url('index.php/barang/update_barang')?>",
        dataType: "JSON",
        data: { kobar: kobar, nabar: nabar, harga: harga },
        success: function (data) {
          $('[name="kobar_edit"]').val("");
          $('[name="nabar_edit"]').val("");
          $('[name="harga_edit"]').val("");
          $('#ModalaEdit').modal('hide');
          tampil_data_barang();
        }
      });
      return false;
    });

    //Hapus Barang
    $('#btn_hapus').on('click', function () {
      var kode = $('#textkode').val();
      $.ajax({
        type: "POST",
        url: "<?php echo base_url('index.php/barang/hapus_barang')?>",
        dataType: "JSON",
        data: { kode: kode },
        success: function (data) {
          $('#ModalHapus').modal('hide');
          tampil_data_barang();
        }
      });
      return false;
    });

  });

</script>
{% include "tambah-data.html" %}
{% block tambah %}

{% endblock tambah %}
{% include "delete-data.html" %}
{% block delete %}

{% endblock delete %}
{% endblock %}